<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reportes - Sistema Ciempiés</title>

    <!-- Bootstrap 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <!-- SweetAlert2 -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">

    <style>
        :root {
          --primary-color: #667eea;
          --secondary-color: #764ba2;
        }

        body {
          background: #f5f7fa;
          font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        .navbar-custom {
          background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
          box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .navbar-brand img {
          width: 45px;
          height: 45px;
          object-fit: contain;
          background: white;
          border-radius: 50%;
          padding: 5px;
        }

        .sidebar {
          background: white;
          min-height: calc(100vh - 56px);
          box-shadow: 2px 0 10px rgba(0,0,0,0.05);
        }

        .sidebar .nav-link {
          color: #333;
          padding: 12px 20px;
          margin: 5px 10px;
          border-radius: 10px;
          transition: all 0.3s ease;
          font-weight: 500;
        }

        .sidebar .nav-link:hover {
          background: #f0f0f0;
          color: var(--primary-color);
        }

        .sidebar .nav-link.active {
          background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
          color: white;
        }

        .sidebar .nav-link i {
          font-size: 20px;
          margin-right: 10px;
          width: 25px;
          text-align: center;
        }

        .main-content {
          padding: 30px;
        }

        .card-reporte {
          border-radius: 15px;
          border: none;
          box-shadow: 0 5px 15px rgba(0,0,0,0.08);
          transition: all 0.3s ease;
          overflow: hidden;
          height: 100%;
        }

        .card-reporte:hover {
          transform: translateY(-5px);
          box-shadow: 0 10px 30px rgba(102, 126, 234, 0.2);
        }

        .card-reporte .card-header {
          background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
          color: white;
          border: none;
          padding: 20px;
        }

        .card-reporte .card-header i {
          font-size: 2.5rem;
          opacity: 0.9;
        }

        .card-reporte .card-body {
          padding: 25px;
        }

        .card-reporte .card-title {
          font-weight: 600;
          color: #333;
          margin-bottom: 10px;
        }

        .card-reporte .card-text {
          color: #666;
          font-size: 14px;
        }

        .btn-download {
          border-radius: 10px;
          padding: 10px 20px;
          font-weight: 500;
          transition: all 0.3s;
        }

        .btn-pdf {
          background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
          border: none;
          color: white;
        }

        .btn-pdf:hover {
          background: linear-gradient(135deg, #c0392b 0%, #a93226 100%);
          color: white;
          transform: scale(1.05);
        }

        .btn-excel {
          background: linear-gradient(135deg, #27ae60 0%, #1e8449 100%);
          border: none;
          color: white;
        }

        .btn-excel:hover {
          background: linear-gradient(135deg, #1e8449 0%, #196f3d 100%);
          color: white;
          transform: scale(1.05);
        }

        .filtros-card {
          border-radius: 15px;
          border: none;
          box-shadow: 0 5px 15px rgba(0,0,0,0.08);
          margin-bottom: 30px;
        }

        .filtros-card .card-header {
          background: white;
          border-bottom: 2px solid #f0f0f0;
          padding: 20px;
          border-radius: 15px 15px 0 0 !important;
        }

        .seccion-titulo {
          display: flex;
          align-items: center;
          margin: 30px 0 20px;
          padding-bottom: 10px;
          border-bottom: 2px solid #e0e0e0;
        }

        .seccion-titulo i {
          font-size: 24px;
          margin-right: 10px;
          color: var(--primary-color);
        }

        .seccion-titulo h4 {
          margin: 0;
          color: #333;
          font-weight: 600;
        }

        .stats-badge {
          background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
          color: white;
          padding: 5px 15px;
          border-radius: 20px;
          font-size: 12px;
          font-weight: 600;
        }

        .form-label {
          font-weight: 600;
          color: #333;
        }

        .form-control, .form-select {
          border-radius: 10px;
          border: 2px solid #e0e0e0;
          padding: 10px 15px;
        }

        .form-control:focus, .form-select:focus {
          border-color: var(--primary-color);
          box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.15);
        }
    </style>
</head>
<body>
<!-- Navbar -->
<nav class="navbar navbar-expand-lg navbar-dark navbar-custom">
    <div class="container-fluid">
        <a class="navbar-brand d-flex align-items-center" href="dashboard.html">
            <img src="images/logo.jpeg" alt="Logo" class="me-2" onerror="this.style.display='none'">
            <span class="fw-bold">Sistema Ciempiés</span>
        </a>

        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav ms-auto align-items-center">
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle text-white" href="#" role="button" data-bs-toggle="dropdown">
                        <i class="bi bi-person-circle me-1"></i>
                        <span id="navUserName">Usuario</span>
                    </a>
                    <ul class="dropdown-menu dropdown-menu-end">
                        <li><h6 class="dropdown-header" id="navUserRole">Rol</h6></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item" href="#" onclick="logout()">
                            <i class="bi bi-box-arrow-right me-2"></i>Cerrar Sesión
                        </a></li>
                    </ul>
                </li>
            </ul>
        </div>
    </div>
</nav>

<div class="container-fluid">
    <div class="row">
        <!-- Sidebar -->
        <nav class="col-md-3 col-lg-2 d-md-block sidebar collapse" id="sidebarMenu">
            <div class="position-sticky pt-3">
                <ul class="nav flex-column">
                    <li class="nav-item">
                        <a class="nav-link" href="dashboard.html">
                            <i class="bi bi-speedometer2"></i>
                            Dashboard
                        </a>
                    </li>
                    <li class="nav-item" id="menuUsuarios" style="display: none;">
                        <a class="nav-link" href="usuarios.html">
                            <i class="bi bi-people-fill"></i>
                            Usuarios
                        </a>
                    </li>
                    <li class="nav-item" id="menuEstudiantes" style="display: none;">
                        <a class="nav-link" href="estudiantes.html">
                            <i class="bi bi-mortarboard-fill"></i>
                            Estudiantes
                        </a>
                    </li>
                    <li class="nav-item" id="menuRutas" style="display: none;">
                        <a class="nav-link" href="rutas.html">
                            <i class="bi bi-map-fill"></i>
                            Rutas
                        </a>
                    </li>
                    <li class="nav-item" id="menuColegios" style="display: none;">
                        <a class="nav-link" href="colegios.html">
                            <i class="bi bi-building-fill"></i>
                            Colegios
                        </a>
                    </li>
                    <li class="nav-item" id="menuAsistencias" style="display: none;">
                        <a class="nav-link" href="asistencias.html">
                            <i class="bi bi-clipboard-check-fill"></i>
                            Asistencias
                        </a>
                    </li>
                    <li class="nav-item" id="menuNotificaciones" style="display: none;">
                        <a class="nav-link" href="notificaciones.html">
                            <i class="bi bi-bell-fill"></i>
                            Notificaciones
                        </a>
                    </li>
                    <li class="nav-item" id="menuReportes" style="display: none;">
                        <a class="nav-link active" href="reportes.html">
                            <i class="bi bi-file-earmark-bar-graph-fill"></i>
                            Reportes
                        </a>
                    </li>
                </ul>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4 main-content">
            <!-- Header -->
            <div class="d-flex justify-content-between align-items-center mb-4">
                <div>
                    <h2><i class="bi bi-file-earmark-bar-graph-fill me-2"></i>Centro de Reportes</h2>
                    <p class="text-muted mb-0">Genera reportes en PDF y Excel con filtros personalizados</p>
                </div>
            </div>

            <!-- ============================================= -->
            <!-- SECCIÓN: REPORTES RÁPIDOS -->
            <!-- ============================================= -->
            <div class="seccion-titulo">
                <i class="bi bi-lightning-fill"></i>
                <h4>Reportes Rápidos</h4>
                <span class="stats-badge ms-3">Sin filtros</span>
            </div>

            <div class="row g-4 mb-4">
                <!-- Usuarios -->
                <div class="col-md-6 col-lg-4">
                    <div class="card card-reporte">
                        <div class="card-header text-center">
                            <i class="bi bi-people-fill"></i>
                        </div>
                        <div class="card-body text-center">
                            <h5 class="card-title">Reporte de Usuarios</h5>
                            <p class="card-text">Listado completo de usuarios del sistema con sus roles y estados.</p>
                            <div class="d-flex gap-2 justify-content-center mt-3">
                                <button class="btn btn-pdf btn-download" onclick="descargarReporte('usuarios', 'pdf')">
                                    <i class="bi bi-file-pdf-fill me-1"></i>PDF
                                </button>
                                <button class="btn btn-excel btn-download" onclick="descargarReporte('usuarios', 'excel')">
                                    <i class="bi bi-file-excel-fill me-1"></i>Excel
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Estudiantes -->
                <div class="col-md-6 col-lg-4">
                    <div class="card card-reporte">
                        <div class="card-header text-center">
                            <i class="bi bi-mortarboard-fill"></i>
                        </div>
                        <div class="card-body text-center">
                            <h5 class="card-title">Reporte de Estudiantes</h5>
                            <p class="card-text">Listado de estudiantes con información de colegios y rutas asignadas.</p>
                            <div class="d-flex gap-2 justify-content-center mt-3">
                                <button class="btn btn-pdf btn-download" onclick="descargarReporte('estudiantes', 'pdf')">
                                    <i class="bi bi-file-pdf-fill me-1"></i>PDF
                                </button>
                                <button class="btn btn-excel btn-download" onclick="descargarReporte('estudiantes', 'excel')">
                                    <i class="bi bi-file-excel-fill me-1"></i>Excel
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Monitores -->
                <div class="col-md-6 col-lg-4">
                    <div class="card card-reporte">
                        <div class="card-header text-center">
                            <i class="bi bi-person-badge-fill"></i>
                        </div>
                        <div class="card-body text-center">
                            <h5 class="card-title">Reporte de Monitores</h5>
                            <p class="card-text">Información de monitores con rutas y zonas asignadas.</p>
                            <div class="d-flex gap-2 justify-content-center mt-3">
                                <button class="btn btn-pdf btn-download" onclick="descargarReporte('monitores', 'pdf')">
                                    <i class="bi bi-file-pdf-fill me-1"></i>PDF
                                </button>
                                <button class="btn btn-excel btn-download" onclick="descargarReporte('monitores', 'excel')">
                                    <i class="bi bi-file-excel-fill me-1"></i>Excel
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Rutas -->
                <div class="col-md-6 col-lg-4">
                    <div class="card card-reporte">
                        <div class="card-header text-center">
                            <i class="bi bi-map-fill"></i>
                        </div>
                        <div class="card-body text-center">
                            <h5 class="card-title">Reporte de Rutas</h5>
                            <p class="card-text">Todas las rutas con tipo, zona y cantidad de estudiantes.</p>
                            <div class="d-flex gap-2 justify-content-center mt-3">
                                <button class="btn btn-pdf btn-download" onclick="descargarReporte('rutas', 'pdf')">
                                    <i class="bi bi-file-pdf-fill me-1"></i>PDF
                                </button>
                                <button class="btn btn-excel btn-download" onclick="descargarReporte('rutas', 'excel')">
                                    <i class="bi bi-file-excel-fill me-1"></i>Excel
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Colegios -->
                <div class="col-md-6 col-lg-4">
                    <div class="card card-reporte">
                        <div class="card-header text-center">
                            <i class="bi bi-building-fill"></i>
                        </div>
                        <div class="card-body text-center">
                            <h5 class="card-title">Reporte de Colegios</h5>
                            <p class="card-text">Colegios con jornadas, zonas y cantidad de estudiantes.</p>
                            <div class="d-flex gap-2 justify-content-center mt-3">
                                <button class="btn btn-pdf btn-download" onclick="descargarReporte('colegios', 'pdf')">
                                    <i class="bi bi-file-pdf-fill me-1"></i>PDF
                                </button>
                                <button class="btn btn-excel btn-download" onclick="descargarReporte('colegios', 'excel')">
                                    <i class="bi bi-file-excel-fill me-1"></i>Excel
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Zonas -->
                <div class="col-md-6 col-lg-4">
                    <div class="card card-reporte">
                        <div class="card-header text-center">
                            <i class="bi bi-geo-alt-fill"></i>
                        </div>
                        <div class="card-body text-center">
                            <h5 class="card-title">Reporte de Zonas</h5>
                            <p class="card-text">Zonas geográficas con estadísticas de colegios y rutas.</p>
                            <div class="d-flex gap-2 justify-content-center mt-3">
                                <button class="btn btn-pdf btn-download" onclick="descargarReporte('zonas', 'pdf')">
                                    <i class="bi bi-file-pdf-fill me-1"></i>PDF
                                </button>
                                <button class="btn btn-excel btn-download" onclick="descargarReporte('zonas', 'excel')">
                                    <i class="bi bi-file-excel-fill me-1"></i>Excel
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ============================================= -->
            <!-- SECCIÓN: REPORTES DE ASISTENCIAS (Con Filtros) -->
            <!-- ============================================= -->
            <div class="seccion-titulo">
                <i class="bi bi-clipboard-data-fill"></i>
                <h4>Reportes de Asistencias</h4>
                <span class="stats-badge ms-3">Con filtros</span>
            </div>

            <!-- Filtros para Asistencias -->
            <div class="card filtros-card">
                <div class="card-header">
                    <h5 class="mb-0"><i class="bi bi-funnel-fill me-2"></i>Filtros de Asistencias</h5>
                </div>
                <div class="card-body">
                    <div class="row g-3">
                        <div class="col-md-3">
                            <label for="filtroFechaInicio" class="form-label">Fecha Inicio</label>
                            <input type="date" class="form-control" id="filtroFechaInicio">
                        </div>
                        <div class="col-md-3">
                            <label for="filtroFechaFin" class="form-label">Fecha Fin</label>
                            <input type="date" class="form-control" id="filtroFechaFin">
                        </div>
                        <div class="col-md-3">
                            <label for="filtroColegio" class="form-label">Colegio</label>
                            <select class="form-select" id="filtroColegio">
                                <option value="">Todos los colegios</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <label for="filtroMonitor" class="form-label">Monitor</label>
                            <select class="form-select" id="filtroMonitor">
                                <option value="">Todos los monitores</option>
                            </select>
                        </div>
                    </div>
                    <div class="row g-3 mt-2">
                        <div class="col-md-4">
                            <label for="filtroEstudiante" class="form-label">Estudiante</label>
                            <select class="form-select" id="filtroEstudiante">
                                <option value="">Todos los estudiantes</option>
                            </select>
                        </div>
                        <div class="col-md-8 d-flex align-items-end gap-2">
                            <button class="btn btn-pdf btn-download" onclick="descargarReporteAsistencias('pdf')">
                                <i class="bi bi-file-pdf-fill me-1"></i>Descargar PDF
                            </button>
                            <button class="btn btn-excel btn-download" onclick="descargarReporteAsistencias('excel')">
                                <i class="bi bi-file-excel-fill me-1"></i>Descargar Excel
                            </button>
                            <button class="btn btn-outline-secondary" onclick="limpiarFiltrosAsistencias()">
                                <i class="bi bi-x-circle me-1"></i>Limpiar
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ============================================= -->
            <!-- SECCIÓN: REPORTES ESTADÍSTICOS -->
            <!-- ============================================= -->
            <div class="seccion-titulo">
                <i class="bi bi-graph-up-arrow"></i>
                <h4>Reportes Estadísticos</h4>
                <span class="stats-badge ms-3">PDF</span>
            </div>

            <div class="row g-4 mb-4">
                <!-- Estadísticas General -->
                <div class="col-md-6 col-lg-4">
                    <div class="card filtros-card h-100">
                        <div class="card-header">
                            <h6 class="mb-0"><i class="bi bi-bar-chart-fill me-2 text-primary"></i>Estadísticas Generales</h6>
                        </div>
                        <div class="card-body">
                            <p class="text-muted small">Resumen general del sistema con totales y porcentajes de asistencia.</p>
                            <div class="mb-3">
                                <label for="fechaEstGeneral" class="form-label">Fecha (opcional)</label>
                                <input type="date" class="form-control" id="fechaEstGeneral">
                            </div>
                            <button class="btn btn-pdf btn-download w-100" onclick="descargarEstadisticasGenerales()">
                                <i class="bi bi-file-pdf-fill me-1"></i>Generar PDF
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Estadísticas por Colegio -->
                <div class="col-md-6 col-lg-4">
                    <div class="card filtros-card h-100">
                        <div class="card-header">
                            <h6 class="mb-0"><i class="bi bi-building me-2 text-primary"></i>Estadísticas por Colegio</h6>
                        </div>
                        <div class="card-body">
                            <p class="text-muted small">Análisis detallado de asistencias por colegio.</p>
                            <div class="mb-3">
                                <label for="colegioEstadisticas" class="form-label">Colegio</label>
                                <select class="form-select" id="colegioEstadisticas">
                                    <option value="">Seleccione colegio...</option>
                                </select>
                            </div>
                            <div class="mb-3">
                                <label for="fechaEstColegio" class="form-label">Fecha (opcional)</label>
                                <input type="date" class="form-control" id="fechaEstColegio">
                            </div>
                            <button class="btn btn-pdf btn-download w-100" onclick="descargarEstadisticasColegio()">
                                <i class="bi bi-file-pdf-fill me-1"></i>Generar PDF
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Estadísticas por Estudiante -->
                <div class="col-md-6 col-lg-4">
                    <div class="card filtros-card h-100">
                        <div class="card-header">
                            <h6 class="mb-0"><i class="bi bi-person-fill me-2 text-primary"></i>Estadísticas por Estudiante</h6>
                        </div>
                        <div class="card-body">
                            <p class="text-muted small">Historial completo de asistencias de un estudiante.</p>
                            <div class="mb-3">
                                <label for="colegioParaEstudiante" class="form-label">Colegio</label>
                                <select class="form-select" id="colegioParaEstudiante" onchange="cargarEstudiantesPorColegio()">
                                    <option value="">Todos los colegios</option>
                                </select>
                            </div>
                            <div class="mb-3">
                                <label for="estudianteEstadisticas" class="form-label">Estudiante</label>
                                <select class="form-select" id="estudianteEstadisticas">
                                    <option value="">Seleccione estudiante...</option>
                                </select>
                            </div>
                            <div class="row g-2 mb-3">
                                <div class="col-6">
                                    <label for="fechaInicioEst" class="form-label">Desde</label>
                                    <input type="date" class="form-control" id="fechaInicioEst">
                                </div>
                                <div class="col-6">
                                    <label for="fechaFinEst" class="form-label">Hasta</label>
                                    <input type="date" class="form-control" id="fechaFinEst">
                                </div>
                            </div>
                            <button class="btn btn-pdf btn-download w-100" onclick="descargarEstadisticasEstudiante()">
                                <i class="bi bi-file-pdf-fill me-1"></i>Generar PDF
                            </button>
                        </div>
                    </div>
                </div>
            </div>

        </main>
    </div>
</div>

<!-- Bootstrap 5 JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<!-- SweetAlert2 -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<!-- Scripts propios -->
<script src="js/config.js"></script>
<script src="js/auth.js"></script>
<script src="js/utils.js"></script>
<script src="js/reportes.js"></script>
</body>
</html>